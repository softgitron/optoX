# Kubernetes networking

## General networking diagram

![optoX networking diagram](https://github.com/softgitron/optoX/tree/main/images/Kubernetes_networking.svg)

## Services availability

All the pods in the single namespace can connect with another pods directly using service names. For example _gateway_ pod can reach _frontend_ pod using DNS `frontend:80`. _database_ and _syncbackend_ pods are also available outside namespace using names like `syncbackend-finland:8080`. All available service names can be seen using command: `kubectl -n <YOUR NAMESPACE (central)> get services`.

## Example listing of Kubernetes services inside container

Inside container: `printenv`
**Note** services in different namespaces are not visible. Those must be accessed directly usign DNS names.

MEDIATOR_PORT_8080_TCP_ADDR=10.110.133.145
KUBERNETES_SERVICE_PORT_HTTPS=443
REGION=central
MEDIATOR_PORT=tcp://10.110.133.145:8080
KUBERNETES_SERVICE_PORT=443
DATABASE_PORT_5432_TCP_PORT=5432
DATABASE_PORT_5432_TCP_PROTO=tcp
GATEWAY_SERVICE_HOST=10.101.60.37
MEDIATOR_SERVICE_PORT=8080
HOSTNAME=database-76784965b-lg8qq
POSTGRES_PASSWORD=optox
MEDIATOR_PORT_8080_TCP_PORT=8080
GATEWAY_PORT_8080_TCP_PROTO=tcp
MEDIATOR_PORT_8080_TCP=tcp://10.110.133.145:8080
SYNCBACKEND_PORT_8080_TCP_PROTO=tcp
MAINBACKEND_PORT_8080_TCP_ADDR=10.109.177.59
FRONTEND_PORT_80_TCP_PROTO=tcp
MAINBACKEND_PORT=tcp://10.109.177.59:8080
PWD=/config
GATEWAY_SERVICE_PORT=8080
DATABASE_SERVICE_HOST=10.97.95.153
SYNCBACKEND_PORT=tcp://10.97.246.23:8080
MAINBACKEND_SERVICE_PORT=8080
GATEWAY_PORT_8080_TCP_ADDR=10.101.60.37
HOME=/root
LANG=en_US.utf8
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
FRONTEND_SERVICE_PORT=80
MAINBACKEND_PORT_8080_TCP_PORT=8080
MAINBACKEND_SERVICE_HOST=10.109.177.59
DATABASE_PORT=tcp://10.97.95.153:5432
SYNCBACKEND_PORT_8080_TCP_ADDR=10.97.246.23
GATEWAY_SERVICE_PORT_HTTP=8080
MEDIATOR_PORT_8080_TCP_PROTO=tcp
MEDIATOR_SERVICE_PORT_HTTP=8080
SYNCBACKEND_PORT_8080_TCP=tcp://10.97.246.23:8080
GOSU_VERSION=1.12
FRONTEND_PORT_80_TCP_PORT=80
SYNCBACKEND_SERVICE_HOST=10.97.246.23
PG_MAJOR=13
GATEWAY_PORT_8080_TCP_PORT=8080
PG_VERSION=13.1-1.pgdg100+1
TERM=xterm
FRONTEND_PORT_80_TCP=tcp://10.111.112.155:80
SYNCBACKEND_SERVICE_PORT_HTTP=8080
DATABASE_PORT_5432_TCP=tcp://10.97.95.153:5432
SHLVL=1
FRONTEND_PORT_80_TCP_ADDR=10.111.112.155
KUBERNETES_PORT_443_TCP_PROTO=tcp
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
POSTGRES_USERNAME=optox
DATABASE_SERVICE_PORT_DATABASE=5432
MAINBACKEND_SERVICE_PORT_HTTP=8080
MEDIATOR_SERVICE_HOST=10.110.133.145
MAINBACKEND_PORT_8080_TCP_PROTO=tcp
PGDATA=/var/lib/postgresql/data
KUBERNETES_SERVICE_HOST=10.96.0.1
GATEWAY_PORT_8080_TCP=tcp://10.101.60.37:8080
KUBERNETES_PORT=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP_PORT=443
SYNCBACKEND_PORT_8080_TCP_PORT=8080
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/postgresql/13/bin
MAINBACKEND_PORT_8080_TCP=tcp://10.109.177.59:8080
SYNCBACKEND_SERVICE_PORT=8080
FRONTEND_SERVICE_HOST=10.111.112.155
DATABASE_SERVICE_PORT=5432
GATEWAY_PORT=tcp://10.101.60.37:8080
DATABASE_PORT_5432_TCP_ADDR=10.97.95.153
POSTGRES_DB=optox
FRONTEND_PORT=tcp://10.111.112.155:80
FRONTEND_SERVICE_PORT_HTTP=80
